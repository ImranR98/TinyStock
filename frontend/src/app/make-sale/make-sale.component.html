<div fxLayout="column" fxLayoutGap="1em" class="stdPadding">
    <div fxLayout="row" fxLayoutGap="1em" fxLayoutAlign="default center">
        <button mat-icon-button (click)="back()">
            <mat-icon svgIcon="back"></mat-icon>
        </button>
        <span class="bigText">Make Sale</span>
    </div>
    <mat-divider></mat-divider>
    <div *ngIf="saleItems.value.length > 0" class="autoOverflow">
        <table mat-table [dataSource]="saleItems" fxFill>
            <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
            <tr mat-row *matRowDef="let myRowData; columns: columnsToDisplay"></tr>
            <tr mat-footer-row *matFooterRowDef="columnsToDisplay"></tr>
            <ng-container matColumnDef="code">
                <th mat-header-cell *matHeaderCellDef> Code </th>
                <td mat-cell *matCellDef="let item"> {{item.code}} </td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef> Description </th>
                <td mat-cell *matCellDef="let item"> {{item.description}} </td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="quantity">
                <th mat-header-cell *matHeaderCellDef> Quantity </th>
                <td mat-cell *matCellDef="let item"> {{item.quantity}} </td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="setQuantity">
                <th mat-header-cell *matHeaderCellDef> Set Quantity </th>
                <td mat-cell *matCellDef="let item"> {{item.setQuantity ? item.setQuantity : 'N/A'}} </td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="category">
                <th mat-header-cell *matHeaderCellDef> Category </th>
                <td mat-cell *matCellDef="let item"> {{item.category}} </td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="itemprice">
                <th mat-header-cell *matHeaderCellDef> Item Price </th>
                <td mat-cell *matCellDef="let item"> {{item.price}} </td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="totalprice">
                <th mat-header-cell *matHeaderCellDef> Total </th>
                <td mat-cell *matCellDef="let item"> {{item.price * item.quantity}}</td>
                <td mat-footer-cell *matFooterCellDef><b><i>{{adjustments.value.length == 0 ? '' : '* '}}</i>{{adjustments.value.length == 0 ? this.total : this.total + adjustments.value[0].amount}}</b></td>
            </ng-container>
            <ng-container matColumnDef="remove">
                <th mat-header-cell *matHeaderCellDef> </th>
                <td mat-cell *matCellDef="let item"><button mat-button color="warn"
                        (click)="deleteItem(item.code, item.setQuantity)">Remove</button></td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
        </table>
    </div>
    <form [formGroup]="itemForm" fxLayout="row" fxLayoutGap="1em" fxLayout.lt-md="column" fxLayoutAlign="default center"
        fxLayoutAlign.lt-md="default default">
        <mat-form-field fxFlex="fill">
            <input matInput formControlName="code" placeholder="Item Code" type="text" required #codeInput>
        </mat-form-field>
        <mat-form-field fxFlex="fill">
            <input matInput formControlName="quantity" placeholder="Quantity" type="number" required>
        </mat-form-field>
        <mat-form-field fxFlex="fill">
            <input matInput formControlName="setQuantity" placeholder="Set Quantity" type="number">
            <mat-hint>Leave this empty if the item is not a set</mat-hint>
        </mat-form-field>
        <button mat-raised-button color="accent" [disabled]="!itemForm.valid || submitting"
            (click)="addItem(); codeInput.focus()">Add</button>
    </form>
    <div *ngIf="adjustments.value.length > 0" fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center center" fxLayoutGap="1em">
        <b><i>* Manual Adjustment: {{adjustments.value[0].amount}} ({{adjustments.value[0].note}})</i></b>
        <button mat-button color="warn" [disabled]="submitting" (click)="removeAdjustment();">Remove Adjustment</button>
    </div>
    <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="1em">
        <button *ngIf="adjustments.value.length == 0" fxFlex="20%" mat-raised-button color="accent"
            [disabled]="saleItems.value.length == 0 || submitting" (click)="adjust();">Manual
            Adjustment</button>
        <button fxFlex="100%" mat-raised-button color="primary" [disabled]="saleItems.value.length == 0 || submitting"
            (click)="makeSale(); codeInput.focus()">Sell</button>
    </div>
</div>